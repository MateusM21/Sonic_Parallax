<!DOCTYPE html>
<html>

<head>
   <title>Fundos rolando em Parallax</title>
   <script src="spritesheet.js"></script>
   <script src="teclado.js"></script>
   <script src="sonic.js"></script>
   <script src="animacao.js"></script>
   <script src="fundo.js"></script>
</head>

<body>
   <canvas id="canvas_fundo" width="500" height="500"></canvas>
   <script>
      
      var imgSonic = new Image(); 
      imgSonic.src = 'sonio.png';

      var imgEspaco = new Image();
      imgEspaco.src = 'img/fundo-espaco.png';

      var imgEstrelas = new Image();
      imgEstrelas.src = 'img/fundo-estrelas.png';

      var imgNuvens = new Image();
      imgNuvens.src = 'img/fundo-nuvens.png';

      var carregadas = 0;
      var total = 4;
      
      imgEspaco.onload = carregando;
      imgEstrelas.onload = carregando;
      imgNuvens.onload = carregando;
      imgSonic.onload = carregando;
      
      function carregando() {
         carregadas++;
         if (carregadas == total) iniciar();
      }

      function iniciar() {
         var canvas = document.getElementById('canvas_fundo');
         var context = canvas.getContext('2d');

         var teclado = new Teclado(document); 
         var animacao = new Animacao(context); 

         var sonio = new Sonic(context, teclado, imgSonic);
         sonio.x = 0; 
         sonio.y = 450;
         sonio.velocidade = 5; 

         
         // Passo o context e a imagem para os objetos Fundo
         var fundoEspaco = new Fundo(context, imgEspaco);
         var fundoEstrelas = new Fundo(context, imgEstrelas);
         var fundoNuvens = new Fundo(context, imgNuvens);

         // Cada um a uma velocidade diferente
         fundoEspaco.velocidade = 2;
         fundoEstrelas.velocidade = 5;
         fundoNuvens.velocidade = 7;
         
         
         animacao.novoSprite(fundoEspaco);
         animacao.novoSprite(fundoEstrelas);
         animacao.novoSprite(fundoNuvens);
         animacao.novoSprite(sonio);

         animacao.ligar();
      }
   </script>
</body>
   
</html>
